# Overview
This repository is intended to showcase a bug in JUnit's Open Test Reporting XML output file.

# The Bug
Depending on the `XMLOutputFactory` that the JVM discovers and decides to use at runtime the Open Test Reporting XML output file may not be well-formed.

This repository includes Woodstox on the test runtime classpath, which exhibits the issue. Removing the Woodstox test runtime dependency will have the JVM use the Java Standard Library `XMLOutputFactory` which does not exhibit this issue.

Other third-party XML libraries may or may not also exhibit this issue.

# Reproducing The Bug
To reproduce this bug simply run `./gradlew test`. JUnit will output a `junit-platform-events-<random-id>.xml` file to the root of the repository. Inspection of this file will reveal that it begins with two newlines before the XML declaration, which is not well-formed.

# A Workaround
Removing a third-party XML dependency is the most straightforward workaround, but in larger systems it may not be possible or desirable.

Setting the `javax.xml.stream.XMLOutputFactory` system property to override the `XMLOutputFactory` implementation to the Java Standard Library implementation also works.

From the command line: 
```
java -cp <classpath> -Djavax.xml.stream.XMLOutputFactory=com.sun.xml.internal.stream.XMLOutputFactoryImpl org.junit.platform.console.ConsoleLauncher execute --config junit.platform.reporting.open.xml.enabled=true --config junit.platform.reporting.output.dir=./ -c <test-class>
```

From inside gradle, add the `systemProperty` to test tasks (Groovy DSL):
```
test {
  ...
  systemProperty("javax.xml.stream.XMLOutputFactory", "com.sun.xml.internal.stream.XMLOutputFactoryImpl")
  ...
}
```
